!function(){"use strict";function e(){let e=document.querySelector(".total-price");if(e){let t=e.textContent.trim();return parseFloat(t)||0}return 0}function t(t){let i={met:!0,hasStarted:!1,remainingTotal:0,remainingProduct:0,remainingTotalPrice:0,remainingProductPrice:0};if(!t.conditions||!t.conditions.type)return i;let r=t.conditions.type;if("total"===r||"both"===r){let n=u(),a=t.conditions.minTotalQuantity||1;n>0&&(i.hasStarted=!0),n<a&&(i.met=!1,i.remainingTotal=a-n)}if(("product"===r||"both"===r)&&t.conditions.requiredProduct){let o=t.conditions.requiredProduct,c=function e(t){let i=document.querySelector(`.product[data-id="${t}"]`);if(!i)return 0;let r=i.querySelector("select.quantity");return r&&parseInt(r.value)||0}(o.id),l=o.minQuantity||1;c>0&&(i.hasStarted=!0),c<l&&(i.met=!1,i.remainingProduct=l-c)}if("price-total"===r||"price-both"===r){let d=e(),s=t.conditions.minTotalPrice||0;d>0&&(i.hasStarted=!0),d<s&&(i.met=!1,i.remainingTotalPrice=s-d)}if(("price-product"===r||"price-both"===r)&&t.conditions.requiredProduct){let m=t.conditions.requiredProduct,p=function e(t){let i=document.querySelector(`.product[data-id="${t}"]`);if(!i)return 0;let r=i.querySelector(".subtotal-price");if(r){let n=r.textContent.trim();return parseFloat(n)||0}return 0}(m.id),f=m.minPrice||0;p>0&&(i.hasStarted=!0),p<f&&(i.met=!1,i.remainingProductPrice=f-p)}if("hybrid"===r){let b=u(),g=t.conditions.minTotalQuantity||0,y=e(),v=t.conditions.minTotalPrice||0;(b>0||y>0)&&(i.hasStarted=!0),b<g&&(i.met=!1,i.remainingTotal=g-b),y<v&&(i.met=!1,i.remainingTotalPrice=v-y)}return i}function i(e){let t=document.querySelector(`.product[data-id="${e}"]`);if(!t)return console.warn(`Product with ID ${e} not found`),null;let i=t.querySelector("td:first-child"),r=i?i.textContent.trim():"";return window.cartConfig.debugMode&&console.log(`ðŸ“¦ Product ${e} found:`,r),{id:e,name:r}}function r(e){let t=e.toFixed(window.cartConfig.currency.decimalPlaces);return"before"===window.cartConfig.currency.position?`${window.cartConfig.currency.symbol}${t}`:`${t}${window.cartConfig.currency.symbol}`}function n(e){return e}function a(e,t){return e-t}function o(e,t){var i,n;let a=(i=t.originalPrice,i-(n=t.discountedPrice)),o=t.savingsText.replace("{amount}",r(a)),c={"{productName}":{value:t.productName,class:"bump-product-name"},"{oldPrice}":{value:r(t.originalPrice),class:"bump-price-old"},"{newPrice}":{value:r(t.discountedPrice),class:"bump-price-new"},"{savings}":{value:o,class:"bump-save"}},l=e;return Object.entries(c).forEach(([e,t])=>{let i=RegExp(e.replace(/[{}]/g,"\\$&"),"gi");l=l.replace(i,`<span class="${t.class}">${t.value}</span>`)}),l}function c(e){if(e.productId){let t=i(e.productId);t&&(e.productName||(e.productName=t.name),t.price&&!e.discountedPrice&&(e.discountedPrice=t.price))}return e.productName?e.discountedPrice?e:(console.error("Order bump missing discountedPrice:",e),null):(console.error("Order bump missing productName:",e),null)}function l(e,t){let i=window.cartConfig.orderBumps[e];if(!i||!i.productId)return console.warn(`Order bump ${e} tidak mempunyai productId`),!1;let r=document.querySelector(`.product[data-id="${i.productId}"]`);if(!r)return console.warn(`Product dengan ID ${i.productId} tidak dijumpai`),!1;let n=r.querySelector("select.quantity");return!!n&&(n.dataset.fromBump="true","undefined"!=typeof $&&$.fn.select2?($(n).val(t.toString()),$(n).trigger("change.select2"),setTimeout(()=>{let e=new Event("input",{bubbles:!0});n.dispatchEvent(e)},50)):(n.value=t.toString(),n.dispatchEvent(new Event("change",{bubbles:!0})),n.dispatchEvent(new Event("input",{bubbles:!0}))),window.cartConfig.debugMode&&console.log(`âœ… Product ${i.productId} (${i.productName}) quantity set to: ${t}`),!0)}function d(){let e=window.cartConfig.orderBumpsLocation,t=null,i="beforebegin";switch(e.position){case"before-payment":default:t=document.getElementById("payment-section"),i="beforebegin";break;case"after-products":t=document.querySelector(".table.table-condensed.purchase_details:not(.table-hover)"),i="afterend";break;case"before-customer":t=document.querySelector("h2.section-header"),i="beforebegin";break;case"custom":t=document.querySelector(e.customSelector),i=e.insertMethod||"afterend"}return t||(console.error(`âŒ Order bump target element not found for position: ${e.position}`),t=document.getElementById("payment-section"),i="beforebegin"),window.cartConfig.debugMode&&console.log(`ðŸ“ Order bump insert target:`,{position:e.position,element:t,method:i}),{targetElement:t,insertMethod:i}}function u(){let e=document.querySelector(".total-quantity");return e&&parseInt(e.textContent)||0}function s(e){let i=t(e);return i.met}function m(){window.cartConfig.orderBumps.forEach((e,n)=>{e.enabled&&function e(n){let a=window.cartConfig.orderBumps[n];if(!a||!a.enabled)return;let o=document.querySelector(`.order-bump-container[data-bump-index="${n}"]`);if(!o)return;let c=t(a),l=c.met,u=c.hasStarted;if(!function e(t,n){if(!window.cartConfig.notifications.enabled)return;let a=window.cartConfig.orderBumps[t];if(!a||!a.conditions||!a.conditions.type)return;let o=`bump-notification-${t}`,c=document.getElementById(o),l=document.querySelector(`.order-bump-container[data-bump-index="${t}"]`);if(n.met){if(c){if(window.cartConfig.notifications.showSuccessMessage){let u=function e(t,i){let r=window.cartConfig.notifications?.messages||{};return(r[t]?.success||"Tahniah! Anda layak untuk {bumpName}").replace(/{bumpName}/g,i||"order bump")}(a.conditions.type,a.productName);c.className="order-bump-notification success",c.innerHTML=`
                    <div class="order-bump-notification-content">
                        <div class="order-bump-notification-icon">
                            <i class="fa fa-check"></i>
                        </div>
                        <div class="order-bump-notification-text">
                            <div class="order-bump-notification-message">${u}</div>
                        </div>
                    </div>
                `,setTimeout(()=>{c&&c.parentNode&&(c.style.animation="slideInNotification 0.3s ease reverse",setTimeout(()=>{c&&c.parentNode&&c.remove()},300))},5e3)}else c&&c.parentNode&&c.remove()}return}if(!n.met&&n.hasStarted){let s=function e(t,n,a){let o=window.cartConfig.notifications?.messages||{},c=o[t]?.pending||({total:"Tambah {remaining} item lagi untuk unlock {bumpName}",product:"Tambah {remaining} {productName} lagi untuk unlock {bumpName}",both:"Perlu: {remainingTotal} item lagi & {remainingProduct} {productName} lagi","price-total":"Tambah lagi {remainingPrice} untuk unlock {bumpName}","price-product":"Tambah lagi {remainingPrice} untuk {productName} untuk unlock {bumpName}","price-both":"Perlu: {remainingTotalPrice} lagi (jumlah) & {remainingProductPrice} lagi ({productName})",hybrid:"Tambah {remainingQuantity} item & {remainingPrice} lagi untuk unlock {bumpName}"})[t];if(!c)return console.warn(`No message template found for condition type: ${t}`),`Unlock ${n.productName}`;let l="";if(n.conditions.requiredProduct){let d=i(n.conditions.requiredProduct.id);l=d?.name||"produk"}let u=c;return(u=(u=(u=(u=(u=(u=(u=(u=u.replace(/{bumpName}/g,n.productName||"order bump")).replace(/{productName}/g,l)).replace(/{remaining}/g,a.remainingTotal||a.remainingProduct||0)).replace(/{remainingTotal}/g,a.remainingTotal||0)).replace(/{remainingProduct}/g,a.remainingProduct||0)).replace(/{remainingQuantity}/g,a.remainingTotal||0)).replace(/{remainingPrice}/g,r(a.remainingTotalPrice||a.remainingProductPrice||0))).replace(/{remainingTotalPrice}/g,r(a.remainingTotalPrice||0))).replace(/{remainingProductPrice}/g,r(a.remainingProductPrice||0))}(a.conditions.type,a,n);if(!c){if((c=document.createElement("div")).id=o,c.className="order-bump-notification",l)l.insertAdjacentElement("beforebegin",c);else{let{targetElement:m,insertMethod:p}=d();m&&m.insertAdjacentElement("beforebegin"===p?"beforebegin":"afterend",c)}}c.innerHTML=`
            <div class="order-bump-notification-content">
                <div class="order-bump-notification-icon">
                    <i class="fa fa-gift"></i>
                </div>
                <div class="order-bump-notification-text">
                    <div class="order-bump-notification-message">${s}</div>
                </div>
            </div>
        `}else c&&c.parentNode&&c.remove()}(n,c),u||l){o.style.display="block";let s=o.querySelector(".order-bump-input"),m=o.querySelector(".order-bump-quantity-wrapper");l?(o.classList.remove("disabled"),s&&(s.disabled=!1),window.cartConfig.debugMode&&console.log(`âœ… Order bump ${n} ENABLED (conditions met)`)):(o.classList.add("disabled"),s&&(s.disabled=!0,s.checked=!1),m&&(m.style.display="none"),window.cartConfig.debugMode&&console.log(`ðŸ”’ Order bump ${n} shown but DISABLED (conditions not met)`))}else o.style.display="none",window.cartConfig.debugMode&&console.log(`ðŸ™ˆ Order bump ${n} hidden (user hasn't started ordering)`)}(n)})}document.addEventListener("DOMContentLoaded",function(){!function e(){if(!window.cartConfig){console.error("cartConfig not found! Please define window.cartConfig before loading this script.");return}!function e(){let t=`
        <div class="cart-container">
            <div class="left-section">
                <i class="fa fa-shopping-cart" id="cartQty" data-count="0"></i>
                <span class="cart-total">0.00</span>
            </div>
            <div class="right-section">
                <button id="cart-toggle-btn">
                    <span class="toggle-btn-txt">TEMPAH SEKARANG</span>
                    <i class="fa fa-times"></i>
                </button>
            </div>
        </div>
        <div id="form-overlay"></div>
    `;document.body.insertAdjacentHTML("beforeend",t)}();let t=document.getElementById("form"),i=document.getElementById("cart-toggle-btn"),r=document.getElementById("cartQty"),n=document.getElementById("form-overlay");function a(){let e=document.querySelector(".total-quantity");if(e){let t=parseInt(e.textContent)||0;r.setAttribute("data-count",t)}}i.addEventListener("click",function(){t.classList.toggle("active"),i.classList.toggle("active"),n.classList.toggle("active")}),n.addEventListener("click",function(){t.classList.remove("active"),i.classList.remove("active"),n.classList.remove("active")});let o=document.querySelector(".total-quantity");if(o){a();let c=new MutationObserver(a);c.observe(o,{childList:!0,characterData:!0,subtree:!0})}function l(){let e=document.querySelector(".total-amount"),t=document.querySelector(".cart-total");if(e&&t){let i=e.textContent.trim();t.textContent=i}}let d=document.querySelector(".total-amount");if(d){l();let u=new MutationObserver(l);u.observe(d,{childList:!0,characterData:!0,subtree:!0})}document.querySelectorAll('input[type="radio"]').forEach(e=>{let t=document.createElement("div");t.className="checkbox-custom",e.insertAdjacentElement("afterend",t)})}();let e=document.querySelector(".toggle-btn-txt");e&&(e.textContent=window.cartConfig.cartButton.text);let t=document.querySelector(".cart-total");if(t&&"before"===window.cartConfig.currency.position)t.style.setProperty("--currency-symbol",`"${window.cartConfig.currency.symbol}"`);else if(t&&"after"===window.cartConfig.currency.position){let i=document.createElement("style");i.textContent=`
            .left-section .cart-total::before { content: none !important; }
            .left-section .cart-total::after { content: "${window.cartConfig.currency.symbol}"; margin-left: 2px; }
        `,document.head.appendChild(i)}let n=document.getElementById("form");n&&!n.classList.contains("active")&&(n.style.visibility="hidden",setTimeout(function(){n.style.visibility="visible"},200)),window.cartConfig.orderBumps.forEach((e,t)=>{e.enabled&&e.productId&&function e(t){let i=document.querySelector(`.product[data-id="${t}"]`);i&&(i.style.visibility="collapse",i.style.opacity="0",window.cartConfig.debugMode&&console.log(`ðŸ™ˆ Product ${t} hidden from table`))}(e.productId)}),function e(){let t=document.querySelectorAll(".product select.quantity");t.forEach(e=>{"undefined"!=typeof $&&$.fn.select2&&$(e).on("change.select2",function(){setTimeout(()=>{m()},100)}),e.addEventListener("change",function(){setTimeout(()=>{m()},100)}),e.addEventListener("input",function(){setTimeout(()=>{m()},100)})});let i=document.querySelector(".total-quantity");if(i){let r=new MutationObserver(()=>{m()});r.observe(i,{childList:!0,characterData:!0,subtree:!0}),function e(){let t=document.querySelectorAll(".subtotal-price");t.forEach(e=>{let t=new MutationObserver(()=>{m()});t.observe(e,{childList:!0,characterData:!0,subtree:!0})});let i=document.querySelector(".total-price");if(i){let r=new MutationObserver(()=>{m()});r.observe(i,{childList:!0,characterData:!0,subtree:!0})}let n=document.querySelector(".total-amount");if(n){let a=new MutationObserver(()=>{m()});a.observe(n,{childList:!0,characterData:!0,subtree:!0})}window.cartConfig.debugMode&&console.log("\uD83D\uDCB0 Price monitoring setup complete")}(),window.cartConfig.debugMode&&console.log("\uD83D\uDC40 Quantity monitoring setup complete")}}();let{targetElement:a,insertMethod:u}=d();a&&(window.cartConfig.orderBumps.forEach((e,t)=>{if(!e.enabled)return;let i=c(e);if(!i){console.error(`Order bump ${t} skipped due to invalid config`);return}let n=o(i.title,i),l=o(i.description,i),d=`order-bump-${t}`,s=`
                <div class="order-bump-container" data-bump-index="${t}">
                    <div class="order-bump-badge">
                        <i class="fa ${i.badgeIcon}"></i> ${i.badgeText}
                    </div>
                    <div class="order-bump-content">
                        <label class="order-bump-checkbox">
                            <input type="checkbox" id="${d}-checkbox" class="order-bump-input" value="1" data-bump-index="${t}">
                            <span class="checkmark"></span>
                            <div class="order-bump-text">
                                <div class="order-bump-title">${n}</div>
                                <div class="order-bump-description">${l}</div>
                            </div>
                        </label>
                        <div class="order-bump-quantity-wrapper" id="${d}-quantity-wrapper" style="display: none;">
                            <div class="bump-quantity-left">
                                <div class="quantity-label">${i.quantityLabel}</div>
                                <div class="quantity-selector">
                                    <button type="button" class="qty-btn qty-minus" data-bump-index="${t}">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                    <input type="number" class="qty-input" id="${d}-qty-input" value="${i.defaultQuantity}" min="${i.minQuantity}" max="${i.maxQuantity}" readonly data-bump-index="${t}">
                                    <button type="button" class="qty-btn qty-plus" data-bump-index="${t}">
                                        <i class="fa fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="quantity-total">
                                <span class="bump-total-price" id="${d}-total-price">${r(i.discountedPrice)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;a.insertAdjacentHTML(u,s)}),setTimeout(()=>{document.querySelectorAll(".order-bump-input").forEach(e=>{let t=parseInt(e.getAttribute("data-bump-index")),i=c(window.cartConfig.orderBumps[t]);if(!i)return;let n=`order-bump-${t}`,a=document.getElementById(`${n}-quantity-wrapper`),o=document.getElementById(`${n}-qty-input`),d=document.getElementById(`${n}-total-price`),u=document.querySelector(`.qty-minus[data-bump-index="${t}"]`),s=document.querySelector(`.qty-plus[data-bump-index="${t}"]`);function m(){let n=parseInt(o.value)||1,a=i.discountedPrice*n;d.textContent=r(a),e.checked&&l(t,n),window.cartConfig.debugMode&&console.log(`Order bump ${t} total: ${r(a)}`)}function p(){let e=parseInt(o.value)||1;u&&(u.disabled=e<=i.minQuantity),s&&(s.disabled=e>=i.maxQuantity)}p(),e.addEventListener("change",function(){if(this.checked){a.style.display="flex";let e=parseInt(o.value)||i.defaultQuantity;if(setTimeout(()=>{l(t,e)},100),m(),i.productId){let r=parseInt(o.value)||i.defaultQuantity;!function e(t,i){let r=document.querySelector(`.product[data-id="${t}"]`);if(r){r.style.visibility="visible",r.style.opacity="1";let n=r.querySelector("td:first-child");if(n&&!n.querySelector(".order-bump-badge-table")){let a=document.createElement("span");a.className="order-bump-badge-table",a.textContent=window.cartConfig.bumpsBadge.text,n.insertBefore(a,n.firstChild),n.insertBefore(document.createTextNode(" "),a.nextSibling)}let o=r.querySelector(".quantity");o&&(o.disabled=!0,o.style.opacity="0.6",o.style.cursor="not-allowed"),window.cartConfig.debugMode&&console.log(`ðŸ‘ï¸ Product ${t} shown as Order Bump`)}}(i.productId,r)}window.cartConfig.debugMode&&console.log(`âœ… Order bump ${t} selected:`,i.productName)}else{var n;a.style.display="none",l(n=t,0),i.productId&&function e(t){let i=document.querySelector(`.product[data-id="${t}"]`);if(i){i.style.visibility="collapse",i.style.opacity="0";let r=i.querySelector(".order-bump-badge-table");if(r){r.remove();let n=i.querySelector("td:first-child").childNodes[0];n&&3===n.nodeType&&""===n.textContent.trim()&&n.remove()}let a=i.querySelector(".quantity");a&&(a.disabled=!1,a.style.opacity="1",a.style.cursor="pointer"),window.cartConfig.debugMode&&console.log(`ðŸ”„ Product ${t} reset and hidden`)}}(i.productId),window.cartConfig.debugMode&&console.log(`âŒ Order bump ${t} deselected`)}}),u&&u.addEventListener("click",function(e){e.preventDefault();let t=parseInt(o.value)||1;t>i.minQuantity&&(o.value=t-1,m(),p())}),s&&s.addEventListener("click",function(e){e.preventDefault();let t=parseInt(o.value)||1;t<i.maxQuantity&&(o.value=t+1,m(),p())}),o&&o.addEventListener("change",function(){let e=parseInt(this.value)||1;e<i.minQuantity&&(e=i.minQuantity),e>i.maxQuantity&&(e=i.maxQuantity),this.value=e,m(),p()})}),m()},500),window.cartConfig.debugMode&&console.log("\uD83C\uDF81 Order Bumps loaded:",window.cartConfig.orderBumps.filter(e=>e.enabled).length,"active"))})}();
